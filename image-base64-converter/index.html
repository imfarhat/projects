<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="https://raw.githubusercontent.com/farhateservices/fesa/main/logo-head-white.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="icon" type="image/png" href="images/tab-top.PNG">
  <title>File Reader by I. Farhat</title>
  <link rel="stylesheet" href="./output.css">
</head>
<body class="bg-blue-100 p-4 flex flex-col items-center justify-center">
  <h1 class="p-4 font-semibold text-center text-base md:text-lg flex flex-wrap items-center justify-center gap-1">Image File <span class="hidden text-xs md:flex">(jpg, jpeg, png, gif)</span> <i class="fa-solid fa-arrow-right-arrow-left mx-2"></i> Base64 Code</h1>
  <form action="#" name="form" id="form" class="p-6 w-full grid grid-cols-1 max-w-4xl items-center justify-center gap-4">

    <div id="message" class="p-4 w-full flex flex-wrap items-center justify-start bg-white rounded-md gap-2">
      <span id="message-title" class="font-semibold text-sm md:text-base">Progress :</span>
      <li id="log-0" class="list-none text-sm md:text-base hidden">Loading logs... </li>
    </div>

    <div class="w-full flex flex-wrap items-center justify-center bg-white rounded-md select-none overflow-hidden">
      <label for="input-file" class="font-semibold flex gap-2 items-center justify-center p-4 pt-6 text-sm md:text-base cursor-pointer w-full hover:bg-blue-50 active:bg-blue-200">Convert Image <i class="fa-solid fa-shuffle"></i> Base64 Code</label>
      <input id="input-file" accept="image/png, image/gif, image/jpeg" class="flex gap-2 items-center justify-center p-4 pb-6 text-sm md:text-base cursor-pointer w-full hover:bg-blue-50 active:bg-blue-200" type="file"></input>
    </div>
    <div id="img-preview-div" class="p-4 rounded-md hidden bg-white flex flex-col items-center justify-center gap-2">
      <h1 id="selected-file-name" lass="p-4 text-center w-full"></h1>
      <img id="img-preview" src="" alt="Previewing selected file" class="bg-white rounded max-w-52 w-full">
    </div>

    <div id="output-b64-div" class="p-4 bg-white rounded-t-md flex items-center justify-between hidden cursor-pointer hover:bg-blue-200 active:bg-blue-300 select-none">
      <h1 id="copy-b64-message" class="font-semibold">Copy Base64 Code <i class="fa-solid fa-clipboard text-xl pl-2"></i></h1>
      <img id="output-b64-tick-img" src="https://storage.needpix.com/rsynced_images/check-mark-2180770_1280.png" alt="Base64 Code Copied" class="h-6 hidden animate-pulse">
    </div>

    <div>
      <textarea name="base64" id="base64-snippet" rows="8" class="w-full rounded-b-md bg-blue-50 -mt-4 p-4 hidden overflow-x-hidden focus:outline-none focus:bg-white focus:border-t-2 transition">Loading base64 code...</textarea>
    </div> 

    <div id="gen-img-f-b64-div" class="p-4 bg-white rounded-t-md flex items-center justify-between gap-2 cursor-pointer hover:bg-blue-200 active:bg-blue-300 select-none text-sm md:text-base">
      <h1 id="gen-img-f-gen-b64" class="font-semibold flex items-center justify-center gap-2 w-full">Convert Base64 <i class="fa-solid fa-shuffle"></i> Image File</h1>
      <img id="gen-img-f-gen-b64-tick-img" src="https://storage.needpix.com/rsynced_images/check-mark-2180770_1280.png" alt="Base64 Code Copied" class="h-6 hidden animate-pulse">
    </div>

    <div>
      <textarea rows="8" name="input-base64" id="input-base64" placeholder="Paste base64 code of image file here...&#10;Base64 code without URI prefix: 'data:image/png;base64'" class="w-full rounded-b-md bg-blue-50 -mt-4 p-4 focus:outline-none focus:bg-white focus:border-t-2 overflow-x-hidden transition"></textarea>
    </div>

    <a id="output-d-file" href="" download class="flex flex-col items-center justify-center gap-2 font-semibold bg-white rounded-md p-6 hidden w-full group">
      <img id="output-f-src" src="" alt="Regenerated Image from Base64" class="max-w-96 pb-2 w-full rounded">
      <div class="flex flex-wrap items-center justify-center p-2 rounded-md group-hover:bg-blue-200 group-active:bg-blue-300 transition w-full select-none">
        <img src="https://cdn-icons-png.flaticon.com/128/7268/7268609.png" alt="Download" class="h-6 md:h-7 p-1.5">
        <h1 class="p-0.5 text-sm md:text-base">Regenerated File</h1>
      </div>
    </a> 
    <details id="log-history" class="relative rounded-md bg-white p-4">
    <summary class="font-semibold transition-all rounded-md pb-2 text-sm md:text-base cursor-pointer select-none">Detailed Log History</summary>
    <button onclick="clearLogs();" id="clear-logs-btn" class="absolute top-2 right-2 bg-red-500 text-white py-1 px-2 md:px-3 z-10 text-sm md:text-balance rounded">Clear <span class="hidden md:inline-block">logs</span>
    </button>
    </details>

  </form>

  <footer class="flex items-center flex-col justify-center">
    <div id="copyright" class="max-w-2xl flex items-center flex-col justify-center md:flex-row md:justify-between p-2 px-6 gap-x-4 bg-blue-100 text-sm"><span class="hidden md:flex">&copy; 2024 File Reader by I. Farhat. All rights reserved. </span><a href="https://farhateservices.github.io/fesa/" target="_blank"><span class="flex flex-row gap-1 items-center justify-center"><span class="hidden md:flex">Powered by</span> <img src="https://farhateservices.github.io/fesa/logo-head-black.png" alt="Farhat e Services & Assistance" loading="lazy" class="h-5 filter bg-blend-multiply">Farhat e Services & Assistance</span></a></div>
  </footer>
  <script>
  // Define constants for element IDs
let inputFile = document.getElementById('input-file');
let previewImgDiv = document.getElementById('img-preview-div');
let previewImg = document.getElementById('img-preview');
let previewFileName = document.getElementById('selected-file-name');
let messageBox = document.getElementById('message');
let intialMessage = document.getElementById('log-0');
let logHistoryBox = document.getElementById('log-history');
let outputImg = document.getElementById('output-f-src');
let outputDFile = document.getElementById('output-d-file');
let outputB64CopyDiv = document.getElementById('output-b64-div');
let outputB64TickImg = document.getElementById('output-b64-tick-img');
let outputB64Message = document.getElementById('copy-b64-message');
let base64Snippet = document.getElementById('base64-snippet');
let genImgDiv = document.getElementById('gen-img-f-b64-div');
let inputBase64 = document.getElementById('input-base64');
let genImgFGenB64 = document.getElementById('gen-img-f-gen-b64');
let genImgFGenB64Tick = document.getElementById('gen-img-f-gen-b64-tick-img');
let clearLogsBtn = document.getElementById('clear-logs-btn');
let imgObj = {};
let result = '';
let rsplit = '';
let pureBase64 ='';

// Event listener for file input change
inputFile.addEventListener('change', () => {
  if (logHistoryBox.innerHTML.length <= 151) {
    logEvent('Image selected, file reading started');
  } else {
    logHistoryBox.innerHTML = `<summary class="font-semibold transition-all rounded-md pb-2 text-sm md:text-base cursor-pointer select-none">Detailed Log History</summary>
      <li class="list-decimal pl-4 text-sm md:text-base"><span class="">Image selected, file reading started</span> - ${new Date().toLocaleTimeString()}.</li>`;
    intialMessage.innerHTML = `<span class="">Image selected, file reading started</span> - ${new Date().toLocaleTimeString()}`;
  }
  intialMessage.classList.remove('hidden');
  logHistoryBox.classList.remove('hidden');

  let fileReader = new FileReader();

  fileReader.addEventListener('loadend', () => {
    result = fileReader.result;
    previewImg.src = result;
    previewFileName.innerHTML = `<b class="font-semibold text-sm md:text-base p-2">Selected File:</b> ${inputFile.files[0].name}`;
    previewImgDiv.classList.remove('hidden');

    logEvent('<span class="text-green-500">Base 64 code generated</span>');
    
    rsplit = result.split("base64,")[1];
    base64Snippet.innerHTML = rsplit;

    logEvent('<span class="text-green-500">Clean base64 code generated</span>');
    
    outputB64CopyDiv.classList.remove('hidden');
    base64Snippet.classList.remove('hidden');

    imgObj = {
      base64: rsplit,
      type: inputFile.files[0].type,
      name: inputFile.files[0].name
    };
  });

  fileReader.readAsDataURL(inputFile.files[0]);
});

// Event listener for clicking the "Copy Base64" button
outputB64CopyDiv.addEventListener('click', () => {
  logEvent('<span class="text-green-600">Copied generated base64 code</span>');
  outputB64TickImg.classList.remove('hidden');

  // Create a temporary textarea element with a specified class
  let textarea = document.createElement('textarea');
  textarea.value = base64Snippet.innerHTML;

  // Append the textarea to the document
  document.body.appendChild(textarea);

  // Select the text in the textarea
  textarea.select();
  textarea.setSelectionRange(0, textarea.value.length);

  // Copy the selected text to the clipboard
  document.execCommand('copy');

  // Remove the temporary textarea from the document
  document.body.removeChild(textarea);
  
  outputB64Message.innerHTML = `Copied Code <i class="fa-solid fa-clipboard-check text-xl pl-2"></i>`;

  setTimeout(() => {
    outputB64TickImg.classList.add('hidden');
    outputB64Message.innerHTML = `Copy Base64 Code <i class="fa-solid fa-clipboard text-xl pl-2"></i>`;
  }, 5000);
});

// Event listener for clicking the "Download" link
outputDFile.addEventListener('click', () => {
  logEvent('<span class="text-green-600">Image (generated from Base64) downloaded successfully</span>');
});

//Function to check if any code in textarea to generate image file
genImgDiv.addEventListener('click', () => {
  if (inputBase64.value.length) {
    logEvent('<span class="">Base64 code reading started</span>');
    outputDFile.href = 'data:image/png;base64,' + inputBase64.value;
    outputImg.src = 'data:image/png;base64,' + inputBase64.value;
    outputDFile.download = `Image Generated from Base64`;
    intialMessage.classList.remove('hidden');
    logHistoryBox.classList.remove('hidden');

    // Check if event listeners are already attached
    let loadListener = () => {
      outputDFile.classList.remove('hidden');
      logEvent('<span class="text-green-600">Image generated from base64 code</span>');
    };

    let errorListener = () => {
      outputDFile.classList.add('hidden');
      logEvent('<span class="text-red-500">Error: Invalid Base64 code, failed to generate image</span>');
    };

    if (!outputImg.hasAttribute('data-event-listeners')) {
      // Add event listeners only if they are not already attached
      outputImg.addEventListener('load', loadListener);
      outputImg.addEventListener('error', errorListener);
      outputImg.setAttribute('data-event-listeners', 'true');
    }
  } else {
    logEvent('<span class="text-red-500">Error: Empty input!, Please paste base64 code of image file</span>');
    intialMessage.classList.remove('hidden');
  }
});

// Function t o clear logs
function clearLogs() {
  logHistoryBox.innerHTML = `
    <summary class="font-semibold transition-all rounded-md pb-2 text-sm md:text-base cursor-pointer select-none">Detailed Log History</summary>
    <button onclick="clearLogs();" id="clear-logs-btn" class="absolute top-2 right-2 bg-red-500 text-white py-1 px-2 md:px-3 z-10 text-sm md:text-balance rounded">Clear <span class="hidden md:inline-block">logs</span>
    </button>
    `;
  logEvent('<span class="text-green-600">Cleared logs</span>');
  intialMessage.classList.remove('hidden');
};

// Function to log events and update UI
function logEvent(message) {
  logHistoryBox.innerHTML += `<li class="list-decimal pl-4 text-sm md:text-base">${message} - ${new Date().toLocaleTimeString()}.</li>`;
  intialMessage.innerHTML = `${message} - ${new Date().toLocaleTimeString()}`;
};

  </script>
<!-- MY CODED JS FROM SCRATCH -->
<!--   
    <script>
    let inputFile = document.getElementById('input-file');
    let previewImgDiv = document.getElementById('img-preview-div')
    let previewImg = document.getElementById('img-preview')
    let previewFileName = document.getElementById('selected-file-name');
    let messageBox = document.getElementById('message');
    let intialMessage = document.getElementById('log-0');
    let logHistoryBox = document.getElementById('log-history');
    let outputImg = document.getElementById('output-f-src');
    let outputDFile = document.getElementById('output-d-file');
    let outputB64CopyDiv = document.getElementById('output-b64-div');
    let outputB64TickImg = document.getElementById('output-b64-tick-img');
    let outputB64Message = document.getElementById('copy-b64-message');
    let base64Snippet = document.getElementById('base64-snippet');
  


    

    inputFile.addEventListener('change', async () => {
      if(logHistoryBox.innerHTML.length<=151) {
        logHistoryBox.innerHTML += `<li class="list-decimal pl-4 text-sm md:text-base"><span class="text-green-600">File reading started</span> - ${new Date().toLocaleTimeString()}.</li>`;
        intialMessage.innerHTML = `<span class="text-green-600">File reading started</span> - ${new Date().toLocaleTimeString()}`;
      } else {
        logHistoryBox.innerHTML = `<summary class="font-semibold transition-all rounded-md pb-2 text-sm md:text-base cursor-pointer">Detailed Log History</summary>
        <li class="list-decimal pl-4 text-sm md:text-base"><span class="text-green-600">File reading started</span> - ${new Date().toLocaleTimeString()}.</li>`;
        intialMessage.innerHTML = `<span class="text-green-600">File reading started</span> - ${new Date().toLocaleTimeString()}`;
      }  
      intialMessage.classList.remove('hidden');
      logHistoryBox.classList.remove('hidden');

      let fileReader = await new FileReader();

      fileReader.addEventListener('loadend', () => {
        let result = fileReader.result;
        previewImg.src=result;
        previewFileName.innerHTML = `<b class="font-semibold text-sm md:text-base p-2">Selected File:</b> ${inputFile.files[0].name}`
        previewImgDiv.classList.remove('hidden');


        logHistoryBox.innerHTML += `<li class="list-decimal pl-4 text-sm md:text-base">Base 64 code generated - ${new Date().toLocaleTimeString()}.</li>`;
        intialMessage.innerHTML = `Base 64 code generated - ${new Date().toLocaleTimeString()}`;

        let rsplit = result.split("base64,")[1];
        base64Snippet.innerHTML = rsplit;

        logHistoryBox.innerHTML += `<li class="list-decimal pl-4 text-sm md:text-base">Cleaned base64 code - ${new Date().toLocaleTimeString()}.</li>`;
        intialMessage.innerHTML = `Cleaned base64 code - ${new Date().toLocaleTimeString()}`;
        
        outputB64CopyDiv.classList.remove('hidden');
        base64Snippet.classList.remove('hidden');


        let imgObj = {
          base64:rsplit,
          type:inputFile.files[0].type,
          name:inputFile.files[0].name
        };

        outputDFile.href = result;
        outputImg.src = result;
        outputDFile.download = `Regenerated ${imgObj.name}`;
        outputDFile.classList.remove('hidden');

        logHistoryBox.innerHTML += `<li class="list-decimal pl-4 text-sm md:text-base">Regenrated the origional file from base64 code - ${new Date().toLocaleTimeString()}.</li>`;
        intialMessage.innerHTML = `Regenrated the origional file from base64 code - ${new Date().toLocaleTimeString()}`;
      });

      fileReader.readAsDataURL(inputFile.files[0]);
    });

    outputDFile.addEventListener("click", () => {
      logHistoryBox.innerHTML += `<li class="list-decimal pl-4 text-sm md:text-base">Image (generated from base-64) downloaded sucessfully - ${new Date().toLocaleTimeString()}.</li>`;
      intialMessage.innerHTML = `Image (generated from base-64) downloaded sucessfully - ${new Date().toLocaleTimeString()}`;
    });

    outputB64CopyDiv.addEventListener("click", () => {

      logHistoryBox.innerHTML += `<li class="list-decimal pl-4 text-sm md:text-base">Copied generated base64 code - ${new Date().toLocaleTimeString()}.</li>`;
      intialMessage.innerHTML = `Copied generated base64 code - ${new Date().toLocaleTimeString()}`;

      outputB64TickImg.classList.remove('hidden');

      // Create a temporary textarea element with a specified class
      let textarea = document.createElement('textarea');
      textarea.value = base64Snippet.innerHTML;

      // Append the textarea to the document
      document.body.appendChild(textarea);

      // Select the text in the textarea
      textarea.select();
      textarea.setSelectionRange(0, textarea.value.length);

      // Copy the selected text to the clipboard
      document.execCommand('copy');

      // Remove the temporary textarea from the document
      document.body.removeChild(textarea);
      outputB64TickImg.classList.remove('hidden');
      outputB64Message.innerHTML = `Copied Base64 Code <i class="fa-solid fa-clipboard-check text-xl pl-2"></i>`; 

      setTimeout(() => {
        outputB64TickImg.classList.add('hidden');
        outputB64Message.innerHTML = `Copy Base64 Code <i class="fa-solid fa-clipboard text-xl pl-2"></i>`;
        console.log("5 sec done");  
      }, 5000);
    });

    // setInterval(() => {
    //   console.log(logHistoryBox.innerHTML.length);
    // }, 2000);

    </script> 
  -->
</body>
</html>